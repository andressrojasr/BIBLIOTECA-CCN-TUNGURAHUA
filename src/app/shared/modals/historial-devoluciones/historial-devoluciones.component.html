<app-header title="Historial de Devoluciones" [isModal]="true"></app-header>
<ion-content [fullscreen]="true">
  <div class="modal-content">
    <!-- Buscador -->
    <div class="search-section">
      <ion-searchbar 
        mode="ios" 
        animated="true" 
        placeholder="Buscar por usuario o libro" 
        [(ngModel)]="searchTerm" 
        (ionInput)="filterHistorial()"
        clearOnEdit="true">
      </ion-searchbar>
    </div>

    <!-- Lista del historial -->
    <ion-list *ngIf="filteredHistorial.length > 0">
      <ion-list-header>
        <ion-label>
          Devoluciones Registradas
          <span class="results-count" *ngIf="searchTerm.trim() !== ''">
            ({{ filteredHistorial.length }} resultado{{ filteredHistorial.length !== 1 ? 's' : '' }})
          </span>
        </ion-label>
      </ion-list-header>
      
      <ion-item *ngFor="let item of filteredHistorial" class="historial-item">
        <ion-label class="historial-label">
          <div class="libro-info">
            <h2>{{ item.tituloLibro }}</h2>
            <p class="codigo-libro">Código: {{ item.codigoLibro }}</p>
          </div>
          
          <div class="usuario-info">
            <p class="usuario-nombre">
              <ion-icon name="person-outline"></ion-icon>
              {{ item.usuarioNombres }} {{ item.usuarioApellidos }}
            </p>
          </div>
          
          <div class="fechas-info">
            <p class="fecha-prestamo">
              <ion-icon name="calendar-outline"></ion-icon>
              Préstamo: {{ item.fechaPrestamo | date:'dd/MM/yyyy' }}
            </p>
            <p class="fecha-devolucion">
              <ion-icon name="checkmark-circle-outline"></ion-icon>
              Devolución: {{ item.fechaDevolucion | date:'dd/MM/yyyy' }}
            </p>
          </div>
        </ion-label>
      </ion-item>
    </ion-list>

    <!-- Estado vacío -->
    <div *ngIf="filteredHistorial.length === 0 && !isProcessing" class="empty-state">
      <ion-icon name="library-outline" class="empty-icon"></ion-icon>
      <ion-text color="medium">
        <h3 *ngIf="searchTerm.trim() === ''">No hay devoluciones registradas</h3>
        <h3 *ngIf="searchTerm.trim() !== ''">No se encontraron resultados para "{{ searchTerm }}"</h3>
        <p *ngIf="searchTerm.trim() !== ''">Intenta con otro término de búsqueda</p>
      </ion-text>
    </div>

    <!-- Spinner de carga -->
    <div *ngIf="isProcessing" class="loading-state">
      <ion-spinner name="crescent"></ion-spinner>
      <ion-text color="medium">
        <p>Cargando historial...</p>
      </ion-text>
    </div>
  </div>
</ion-content>